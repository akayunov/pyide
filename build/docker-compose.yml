version: "3.4"

networks:
  pyide:
    attachable: true

services:
  pyide:

    hostname: pyide

    image: registry.hub.docker.com/akayunov/pyide:latest

    networks:
      pyide:
        aliases:
          - pyide

    logging:
      driver: "json-file"

    volumes:
      - type: bind
        source: ../src
        target: /opt/pyide/src
        read_only: true
      - type: bind
        source: ../test/server/resourses
        target: /opt/pyide/test/server/resourses
        read_only: true
      - type: bind
        source: ../tmp
        target: /opt/pyide/tmp
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: none
      endpoint_mode: vip

# diff from release
    ports:
      - "31415:31415"

    environment:
      PYTHONPATH: /opt/pyide/src
    command: ['python3', '-m', 'pyide']