version: "3.4"

networks:
  pyide:
    attachable: true

services:
  pyide:

    hostname: pyide

    image: registry.hub.docker.com/akayunov/pyide:latest

    networks:
      pyide:
        aliases:
          - pyide

    logging:
      driver: "json-file"
      options:
        mode: non-blocking

    volumes:
      - type: bind
        source: ../pyide-server
        target: /opt/pyide/pyide-server
        read_only: true
      - type: bind
        source: ../pyide-client
        target: /opt/pyide/pyide-client
        read_only: true
#      - type: bind
#        source: ../pyide-server/test/resourses
#        target: /opt/pyide/test/resourses
#        read_only: true
#      - type: bind
#        source: ../tmp
#        target: /opt/pyide/tmp
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: none
      endpoint_mode: vip
    labels:
      name: "pyide"

# diff from release
    ports:
      - "31415:31415"
      - "5555:5555"

    environment:
      PYTHONPATH: /opt/pyide/pyide-server/src
      PYTHONUNBUFFERED: 'true'
    command: ['python3', '-m', 'pyide', '-d']
